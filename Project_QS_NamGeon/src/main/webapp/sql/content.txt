-- 콘텐츠 목록 --
DROP SEQUENCE CONTENT_SEQ;
CREATE SEQUENCE CONTENT_SEQ
INCREMENT BY 1
START WITH 1
MINVALUE 1
;

DROP TABLE CONTENT_LIST CASCADE CONSTRAINTS;
CREATE TABLE CONTENT_LIST(
  CONTENT_KEY NUMBER PRIMARY KEY,
  TITLE VARCHAR2(60) NOT NULL,
  EXPLANATION VARCHAR2(150) NOT NULL,
  CREATE_USER NUMBER NOT NULL REFERENCES MEMBER_INFO(MEMBER_KEY) ON DELETE CASCADE,
  THUMBNAIL VARCHAR2(30) NOT NULL,
  CONTENT_COUNT NUMBER NOT NULL,
  CONTENT_PUBLIC VARCHAR2(1) DEFAULT 'N' CHECK(CONTENT_PUBLIC IN('N','Y')),
  CONTENT_TYPE VARCHAR2(6) CHECK(CONTENT_TYPE IN('QUIZ','SURVEY')),
  CREATE_DAY DATE DEFAULT SYSDATE
);

INSERT INTO CONTENT_LIST(CONTENT_KEY,TITLE,EXPLANATION,CREATE_USER,THUMBNAIL,CONTENT_COUNT,CONTENT_PUBLIC,CONTENT_TYPE)
VALUES(CONTENT_SEQ.NEXTVAL,'동물퀴즈','동물을 맞추는 퀴즈입니다.',1,'임시이미지.jpg',2,'Y','QUIZ');

INSERT INTO CONTENT_LIST(CONTENT_KEY,TITLE,EXPLANATION,CREATE_USER,THUMBNAIL,CONTENT_COUNT,CONTENT_PUBLIC,CONTENT_TYPE)
VALUES(CONTENT_SEQ.NEXTVAL,'동물퀴즈','동물을 맞추는 퀴즈입니다.',3,'임시이미지.jpg',2,'Y','QUIZ');

SELECT * FROM CONTENT_LIST;
SELECT MAX(CONTENT_KEY) LAST_KEY FROM CONTENT_LIST;

SELECT CONTENT_KEY,TITLE,EXPLANATION,T10.CREATE_USER,THUMBNAIL,CONTENT_COUNT,CONTENT_PUBLIC,CREATE_DAY,T20.BAN,T20.USER_NAME, NVL(CNT, 0) CNT
FROM (SELECT T11.CONTENT_KEY,TITLE,EXPLANATION,CREATE_USER,THUMBNAIL,CONTENT_COUNT,CONTENT_PUBLIC,CREATE_DAY,CNT
      FROM (SELECT *
            FROM CONTENT_LIST
            WHERE CONTENT_PUBLIC = 'Y') T11
      LEFT OUTER JOIN
           (SELECT CONTENT_KEY, COUNT(*)CNT
            FROM PLAY_RECORD
            GROUP BY CONTENT_KEY) T12
      ON T11.CONTENT_KEY = T12.CONTENT_KEY)T10
    ,(SELECT MEMBER_KEY,BAN,USER_NAME
      FROM MEMBER_INFO
      WHERE BAN = 'N') T20
WHERE T10.CREATE_USER = T20.MEMBER_KEY
ORDER BY CNT DESC, CONTENT_KEY DESC;

SELECT CONTENT_KEY,TITLE,EXPLANATION,T10.CREATE_USER,THUMBNAIL,CONTENT_COUNT,CONTENT_PUBLIC,CREATE_DAY,T20.BAN,T20.USER_NAME, NVL(CNT, 0) CNT
FROM (SELECT T11.CONTENT_KEY,TITLE,EXPLANATION,CREATE_USER,THUMBNAIL,CONTENT_COUNT,CONTENT_PUBLIC,CREATE_DAY,CNT
      FROM (SELECT *
            FROM CONTENT_LIST) T11
      LEFT OUTER JOIN
           (SELECT CONTENT_KEY, COUNT(*)CNT
            FROM LIKE_CONTENT
            GROUP BY CONTENT_KEY) T12
      ON T11.CONTENT_KEY = T12.CONTENT_KEY)T10
    ,(SELECT MEMBER_KEY,BAN,USER_NAME
      FROM MEMBER_INFO
      WHERE BAN = 'N') T20
WHERE T10.CREATE_USER = T20.MEMBER_KEY
AND (USER_NAME LIKE '%리%' OR TITLE LIKE '%리%')
ORDER BY CNT DESC, CONTENT_KEY DESC;

SELECT COUNT(*)
FROM PLAY_RECORD;


SELECT * 
FROM (SELECT * 
      FROM CONTENT_LIST) T10
    ,(SELECT CONTENT_KEY 
      FROM LIKE_CONTENT 
      WHERE MEMBER_KEY = 1) T20
WHERE T10.CONTENT_KEY = T20.CONTENT_KEY;


SELECT CONTENT_KEY,TITLE,EXPLANATION,T10.CREATE_USER,THUMBNAIL,CONTENT_COUNT,CONTENT_PUBLIC,CREATE_DAY,T20.BAN,T20.USER_NAME
FROM (SELECT T11.CONTENT_KEY,TITLE,EXPLANATION,CREATE_USER,THUMBNAIL,CONTENT_COUNT,CONTENT_PUBLIC,CREATE_DAY
      FROM (SELECT * 
            FROM CONTENT_LIST) T11
          ,(SELECT CONTENT_KEY 
            FROM LIKE_CONTENT 
            WHERE MEMBER_KEY = 1) T12
      WHERE T11.CONTENT_KEY = T12.CONTENT_KEY)T10
    ,(SELECT MEMBER_KEY,BAN,USER_NAME
      FROM MEMBER_INFO
      WHERE BAN = 'N') T20
WHERE T10.CREATE_USER = T20.MEMBER_KEY
ORDER BY CONTENT_KEY DESC;








